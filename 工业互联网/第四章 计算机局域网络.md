局域网定义：局域网是在一个**较小**的范围，利用**通信线路**将**众多计算机（一般为微机）及外设**连接起来，达到**数据通信及资源共享**目的的一种网络
### 局域网的概述
#### 局域网的特点
* 覆盖范围小
* 高传输速率
* 低误码率
* 采用星形、环形、总线、树形拓扑
* 为一个单位所共有
* **技术侧重点是共享信息/信道资源的处理**
#### 局域网的关键技术
* 拓扑结构
* 数据传输形式
* 介质访问控制方法
这三种技术在很大程度上决定了**传输介质、传输数据的类型、网络的响应时间、吞吐量和效率**
1. 局域网的典型拓扑结构
	* 星型
	* 环型
	* 总线型
2. 传输形式
	* 基带传输：**数字脉冲信号**直接传输
	* 频带传输：数字脉冲信号**经载波调制**后在传输介质上传输
	有线局域网中主要的传输形式为**基带传输**，**频带传输**用在无线局域网中
3. 介质访问控制方法
	即信道访问控制方法（**信道共享方法**），指网络中的多个站点**如何共享通信媒体（介质）**的
	* 带冲突检测的载波侦听多路访问CSMA/CD
	* 冲突避免的载波侦听多路访问CSMA/CA（无线局域网）
	* 令牌环（TOKEN PASSING）
	* 令牌总线（TOKEN PASSING）
#### 局域网体系结构
1. IEEE802标准简介
	描述**物理层**和**数据链路层**的功能及**与网络层的接口服务**
	IEEE定义的**物理层功能**
	1. **位流**的发送/接收
	2. **前导码**（前缀）的生成/出去（用于位同步）
	3. 信号的**编码/译码**（用于位同步）
	具体规定信号编码/译码（曼彻斯特编码、曼彻斯特差分编码）、拓扑结构、传输媒体和速率
	
	IEEE802委员会按功能将数据链路层划分为两个子层
	1. **逻辑链路控制（LLC）** 子层（数据链路控制子层）
	2. **介质访问控制（MAC）** 子层（媒体访问控制子层）
	功能分解的原因与目的
	* 将与硬件相关和无关的部分分开，降低实现的复杂度
	* 局域网特点：共享信道，需要解决**介质访问控制**问题
	* 分层可以使**LLC帧的传输独立于介质和MAC方法**
	LLC功能
	* 向高层提供一个或多个服务访问点（SAP：两个相邻层之间的逻辑接口）
	* 数据帧的发送/接收
	* 帧顺序控制、差错控制和流量控制
	* 某些网络层功能，如数据报、虚电路和多路复用等。
	MAC功能
	* 管理多个链路和多个目的链路
	* IEEE802制定了若干介质访问控制方法
	**LLC：与介质、拓扑无关**
	**MAC：与介质、拓扑相关**
	实际应用一般不考虑LLC层
	
	LAN的网络层和更高层
	* **网络层的很多功能(如路由选择等)是没有必要的**，故IEEE 802 标准没有单独设立网络层。
	* **IEEE802没有定义局域网的高层**，在实际计算机网络中，一般 由TCP/IP等协议集和网络操作系统（NOS：Unix、Windows NT、Netware ）共同来实现。
2. IEEE802标准的组成
	![[Pasted image 20251030232557.png]]
### 介质访问控制方法

信道分配问题
计算机网络按照通信传播方式可以分为两类
* **点到点连接的网络——广域网**
* **广播信道的网络——局域网
**解决信道争用问题的协议称为介质访问控制协议MAC**，是**数据链路层**协议的一部分
相关概念
* **冲突**：在**广播式**信道中（例如总线型网络中的总线，WIFI）， 有两个或两个以上工作站同时发送数据，在信道上产生**信号的混合**。
* **载波侦听**：发送信息**前**，检测信道的空闲状态
* **冲突检测**：发送信息**中**，检测是否发生冲突
* **多路访问**：多结点（工作站）访问同一媒体（共享信道），或者多结点从同一媒体接收信息。
* **多路访问协议**：控制多个用户共用一条信道的协议	![[Pasted image 20251030233621.png]]
CSMA/CA在CSMA/CD随机接入的基础上增加了**响应控制**来**避免冲突**

小结：
* **静态**方式：通过**多条链路**（增加系统带宽）来实现信道共享
* **动态**方式：在一条链路上，**通过协议的设计**（冲突规避算法）来实现信道共享
	* **统计复用**的思想：从统计角度看，多个用户共享少数信道， 在较大概率下并无冲突，而较小概率的冲突则可以被忽略。 
		* 受控接入的思想：**避免冲突**；适用于重载网络（令牌） 
		* 随机接入的思想：**处理冲突**；适用于轻载网络 （CSMA/CD）

CSMA/CD（带冲突检测的载波侦听多路访问协议）
解决问题
* 各站点如何**访问共享介质**
* 如何**解决**同时访问造成的**冲突**
CSMA/CD对站点的要求
* 具有判断**信道忙/闲**的能力（**物理实现**：利用站点的接收器接收信道上传输的信号：信号有变化——忙，无变化——闲）
* 具有判断**冲突**的能力（**物理实现**：通过检测信道上反馈信号与传送信号比较就可判断）

**载波侦听多路访问协议（CSMA）**
**讲前先听**：发送前**首先需侦听总线**
**坚持退避**：”**等待**一段时间“
* 非坚持（不坚持）CSMA：若忙**等待随机一段时间**后再重新监听
* 1-坚持型CSMA：若忙**继续侦听直至发现信道空闲**
* p-坚持型CSMA：若站点发现信道空闲，则以**概率p发送数据**，以概率q =1 p 延迟一个时间单位（时间单位等于最大的传播延迟）
	p值的选择：N×p<1 （N为介质忙时，要发送数据的站点数）
**CSMA技术无法解决发送中的冲突问题**

**带冲突检测的载波侦听多路访问协议（CSMA/CD）
* 站点使用**某种CSMA**协议进行数据发送
* 站点**在发送帧的同时需要继续侦听是否发生冲突**，若在帧发送期间检测到冲突，立即终止发送，并向介质发出一串**干扰（阻塞）** 信号，使**所有的站点都知道**发生了冲突；
* 在发出干扰信号（阻塞）后，等待一段**随机时间**，再重复第一步。
**CD的意义：及时中止已经冲突的数据传输，将损失降低到最小。**
**重要特性
![[Pasted image 20251031000925.png]]
* 从上面的分析可知，A发送数据后，最迟经过两倍的端到端的传播时延（2$\tau$）就能知道自己发出的数据是否发生了碰撞。
* 2 $\tau$为检测到冲突的最长时间长度，经过这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。
* 由此可见，每一个站在发送数据之后的一小段时间内（2$\tau$）， 存在着遭遇碰撞的可能性。**这一小段时间是不确定的**，它取决于两个发送数据的主机之间的距离。CSMA/CD的这一特点称为发 送的不确定性。
* 以太网采用了CSMA/CD 协议，这种发送的**不确定性使整个以太网的平均通信量远小于以太网的最高传输速率**。
传统以太网中**最短帧长**的计算
* 传统以太网取f(s)=51.2 $ms$ 为争用期2$\mu$的长度（大约S=5km电缆线）
* 对于R=10 Mbps 以太网，在争用期内可发送Fmin=512 bit，即64 字节
* 传统以太网在发送数据时，若**前64 字节没有发生冲突，则后续的数据就不会发生冲突**
传统以太网中**最短有效帧长——64Byte**
* 以太网规定了最短有效帧长为64 字节，凡**长度小于64 字节的帧**都是由于冲突而异常中止的**无效帧**（碎片帧）

**CSMA/CD中使用的退避算法（实际应用算法）**
以太网使用**截断二进制指数类型**的**退避算法**解决死锁问题（是一种1-坚持和p坚持的**时隙型**混合算法）
1. 确定基本退避时间T，一般取为时间槽长度（时隙），即T＝$\tau$
2. 定义一个**参数**k，它等于重传的次数，但不超过10，即 **k＝min（重传次数，10）**
3. 从离散的整数集合0，1，…，（$2^k - 1$）中随机的抽取一个数， 记为r。则重传前需要延迟的时间为rT；
4. 当重传达**16次**仍不能成功，则丢弃帧，并向上层软件或管理实体报告，由他们来决定如何处理此错误

**CSMA/CD与CSMA/CA的区别**
1. CSMA/CD协议主要应用于**有线以太网**环境中。它的工作原理： 讲前先听→边讲边听→冲突停发→强化冲突→随机重发。
2. CSMA/CA协议主要用于**无线局域网**（如Wi-Fi）。在CSMA/CA 中，设备在检测到信道空闲时，并不立即发送数据，而是等待一段时间后再发送，以减少冲突的可能性。此外，设备可能会先发送一个小的信道侦测帧（如RTS），如果收到CTS响应，表明信道空闲，然后再发送数据。CSMA/CA通过这种主动避免冲突的方 式来提高网络效率。

### 传统以太网
**以太网的物理层选项**
以太网简写名称：< 以 Mbps 为单位的数据速率 >< 信号方式 >< 以百米为单位的最大段长度 / 介质类型 >
#### MAC地址
* IEEE802标准为每个网络设备规定了一个**48位**的**全局地址**，它是站点的**全球唯一**的硬件设备**标识符**，与其物理位置**无关**，又称**网络设备物理地址**或**硬件地址**
* 在**局域网中**，是指局域网上的每台计算机所插入的网卡上固化在ROM中的地址，也称为**MAC地址**
* MAC地址为**6Byte（48位）**，可标识约70万亿个地址；
* MAC地址的前3个字节（高24位）称为**机构唯一标识符OUI （Organization Unique Identifier）**，用以标识设备生产厂 商，由IEEE统一分配给厂商，例如3COM网络设备的前三个字节是02608C；
* MAC地址的后三个字节（低24位）称为**扩展标识符EI** （Extended Identifier），用以标识生产出来的每个联网设备，由厂商分配给每一个联网设备（例如标识每一块不同的网卡，网卡的MAC地址可以认为就是该网卡所在站点的MAC地址）

#### MAC帧格式
常用的以太网MAC帧格式有两种标准：
* DIX Ethernet V2标准
* IEEE的802.3标准
最常用的MAC帧是DIX Ethernet V2 的格式
![[Pasted image 20251031101405.png]]

类型字段用来标志上一层使用的是什么协议，以便把收到的MAC帧的数据上交给上一层的这个协议
* 当类型字段的值是0x0800时，就表示上层使用的IP数据报。
* 若类型字段的值为0x8137，则表示该帧是由Novell IPX发过来的。
* 最小长度64 字节−18 字节的首部和尾部=数据字段的最小长度（数据字段46~1500字节）当数据字段的长度小于46 字节时，应在数据字段的后面加入整数字节的填充字段， 以保证以太网的MAC 帧长不小于64 字节。
* 在帧的前面插入的8 字节中的第一个字段共7个字节， 是前同步码，用来迅速实现MAC 帧的比特同步。 第二个字段是帧开始定界符，表示后面的信息就是MAC 帧。（为了达到比特同步， 在传输媒体上实际传送的 要比MAC 帧还多8 个字节）![[Pasted image 20251031102301.png]]
* PA：前同步码-10101010序列，用于使接收方与发送方**位同步**
* SFD：帧首定界-10101011**帧同步**
* DA：目的MAC地址；SA：源MAC地址
* LEN：数据长度（数据部分的字节数LLC PDU+pad）（46-1500B）
* Type：类型。高层协议标识（IP：0800H；ARP：0806H；X.25:0805H）
* LLC PDU + pad--最少46字节，最多1500字节
* Pad：填充字段，保证帧长**不少于64字节**（若Data域大于等于46字节，则无Pad）
* FCS：帧校验序列（CRC-32）
**封装**帧时**目的MAC地址**的三种类型——发送时
* 单播（**一对一**）
* 广播（**一对全体**）
* 多播（**一对多**）
**解封装**时网卡检查**目的MAC地址**——接收时：网卡从网络上每收到一个MAC帧就首先用硬件检查MAC帧中的目的MAC地址（是就收下，否则丢弃）
**字段重用**：长度/类型字段（<1500指示长度，>1500指示上一层使用的协议）**帧格式设计常用手段**
无效MAC帧
* 帧长度不是整数个字节
* 用收到的帧检验序列FCS查出有差错
* 数据字段的长度不在46~1500字节之间

DIX Ethernet / IEEE 802.3 Ethernet 操作
* 每个站点都可以接收到**所有来自其他站点**的数据
* 为决定哪个站点接收，需要**寻址机制**来标识目的站点
* 目的站点将该帧**复制**，其他站点则**丢弃**该帧
